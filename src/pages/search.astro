---
import Layout from '../layouts/Layout.astro';
import InfinitePaperList from '../components/InfinitePaperList';
import SearchBar from '../components/SearchBar';
import { searchPapers } from '../lib/arxiv';

const q = Astro.url.searchParams.get('q') || '';
const title = q ? `Search results for "${q}"` : 'Search';

let entries: any[] = [];
let totalResults = 0;

if (q) {
    try {
        const result = await searchPapers(q, 0, 12);
        entries = result.entries;
        totalResults = result.totalResults;
    } catch (e) {
        console.error(e);
    }
}
---

<Layout title={`${title} - Modern arXiv`}>
    <div class="container mx-auto px-4 py-12 space-y-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 border-b border-primary/20 pb-4">
            <h1 class="text-2xl md:text-3xl font-bold truncate uppercase tracking-wider font-display">
                {q ? <><span class="text-primary mr-2">QUERY:</span>"{q}"</> : 'INITIATE_SEARCH_SEQUENCE'}
            </h1>
            <div class="w-full md:w-auto md:min-w-[400px]">
                 <SearchBar client:load initialQuery={q} className="w-full drop-shadow-[0_0_10px_hsl(var(--primary)/0.1)]" />
            </div>
        </div>

        {q ? (
            <div class="space-y-4">
                <p class="text-xs font-mono text-muted-foreground uppercase tracking-widest border-l-2 border-primary/50 pl-3">
                    STATUS: SUCCESS // FOUND {totalResults} RECORDS
                </p>
                <InfinitePaperList
                    client:load
                    initialPapers={entries}
                    query={q}
                    totalResults={totalResults}
                />
            </div>
        ) : (
            <div class="flex flex-col items-center justify-center py-24 text-center text-muted-foreground border border-dashed border-primary/20 bg-primary/5 rounded-none">
                <p class="text-lg font-mono uppercase tracking-widest">Awaiting Input...</p>
                <p class="text-xs mt-2 opacity-50">Enter keywords to query the database.</p>
            </div>
        )}
    </div>
</Layout>
